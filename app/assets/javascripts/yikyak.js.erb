$(function(){
  
  $(".btn-upvote-yak").click(function(){
    var yak = $(this).data("yak");
    var type = $(this).data("type");
    var currentLikes = $(this).parent().parent().prev();
    postVoteAjax("upvote",yak,type,currentLikes);
    $(this).addClass("active");
    $(this).next().addClass("disabled");
    $(this).next().removeClass("btn-danger").addClass("btn-link");
  });
  
  $(".btn-downvote-yak").click(function(){
    var yak = $(this).data("yak");
    var type = $(this).data("type");
    var currentLikes = $(this).parent().parent().prev();
    postVoteAjax("downvote",yak,type,currentLikes);
    $(this).addClass("active");
    $(this).prev().addClass("disabled");
    $(this).prev().removeClass("btn-info").addClass("btn-link");
  });
  
  function postVoteAjax(action,type,yak,currentLikes){
    var likes = parseInt(currentLikes.html());
    $.ajax({
      type: "POST",
      dataType: "json",
      data: {
        yak: yak,
        type: type
      },
      url: "/service/"+action,
      statusCode: {
        200: function(data) {
          if(action == "downvote")
            likes -= 1;
          else
            likes++;
          currentLikes.html(likes)
          
        },
        500: function(xhr, textStatus, errorThrown) {
          
        },
        402: function(xhr, textStatus, errorThrown) {
          
        },
        400: function(xhr, textStatus, errorThrown) {
          console.log("no hay nada");
        },
        406: function(xhr, textStatus, errorThrown) {
          
        }
      }
    });
  }
  
});